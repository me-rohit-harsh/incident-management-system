<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>Admin Dashboard</title>
<link
	href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css'
	rel='stylesheet'>
<link
	href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css'
	rel='stylesheet'>
<script
	src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js'></script>

</head>
<body>
	    <div class="container mt-5">
        <h2>Admin Dashboard</h2>
        <!-- Form with Bootstrap classes -->
        <form th:action="@{/admindashboard}" method="get" class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" name="incidentId" placeholder="Search by Incident ID" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>

        <table class="table mt-4">
            <thead class="thead-dark">
                <tr>
                    <th>Incident ID</th>
                    <th>User ID</th>
                    <th>Details</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Reported Date</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="incident : ${incidents}">
                    <td th:text="${incident.id}"></td>
                    <td th:text="${incident.userId}"></td>
                    <td th:text="${incident.details}"></td>
                    <td th:text="${incident.status}"></td>
                    <td th:text="${incident.priority}"></td>
                    <td th:text="${incident.reportedDate}"></td>
                </tr>
            </tbody>
        </table>
    </div>
	<script>
document.addEventListener('DOMContentLoaded', function () {
    const statusSelectors = document.querySelectorAll('.status-selector');
    statusSelectors.forEach(selector => {
        selector.addEventListener('change', function () {
            const incidentId = this.getAttribute('data-incident-id');
            const newStatus = this.value;

            fetch(`/updateStatus/${incidentId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // 'X-CSRF-TOKEN': 'YOUR_CSRF_TOKEN_HERE' // Uncomment and replace if CSRF protection is enabled
                },
                body: JSON.stringify({ status: newStatus })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                alert('Status updated to: ' + newStatus);
            })
            .catch(error => {
                console.error('Error updating status:', error);
            });
        });
    });
});
</script>


	<script>
		document.addEventListener('DOMContentLoaded', function() {
			var popoverTriggerList = [].slice.call(document
					.querySelectorAll('[data-bs-toggle="popover"]'))
			var popoverList = popoverTriggerList
					.map(function(popoverTriggerEl) {
						return new bootstrap.Popover(popoverTriggerEl)
					});
		});
	</script>

</body>
</html>
